<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(30, 20px);
            grid-template-rows: repeat(30, 20px);
            gap: 2px;
            border: 2px solid #000;
        }
        .cell {
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #fff;
            border: 1px solid #ddd;
        }
        .apple {
            font-size: 15px;
        }
        #gameStatus {
            position: absolute;
            top: 20px;
            font-size: 24px;
        }
        #speedControl {
            margin-top: 20px;
            width: 300px;
        }
        .slider-container {
            margin-top: 10px;
            text-align: center;
        }
        #restartButton {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            display: none;
        }
        #restartButton:hover {
            background-color: #45a049;
        }
        #exitButton {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #f44336;
            color: white;
            border: none;
            cursor: pointer;
        }
        #exitButton:hover {
            background-color: #e53935;
        }
        #exitLink {
            color: white;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <button id="exitButton"><a href="index.html" id="exitLink">Salir</a></button>
    <div class="grid" id="grid"></div>
    <h1 id="gameStatus">¬°Presiona cualquier tecla para empezar!</h1>

    <div class="slider-container">
        <label for="speedControl">Velocidad del juego:</label>
        <input type="range" id="speedControl" min="2" max="1000" value="200" step="2">
        <span id="speedValue">200ms</span>
    </div>

    <button id="restartButton" onclick="restartGame()">Reiniciar Juego</button>

    <script>
        const gridSize = 30;  // Cambi√© el tama√±o de la cuadr√≠cula a 30x30
        let playerSnake = [{ x: 14, y: 14 }];
        let playerDirection = { x: 0, y: -1 };
        let aiSnake = [{ x: 16, y: 16 }];
        let aiDirection = { x: 0, y: -1 };
        let apple = { x: 12, y: 12 };
        let gameOver = false;
        let gameStarted = false;
        let canMove = true;
        let speed = 200;

        // Crear la cuadr√≠cula
        function createGrid() {
            const gridElement = document.getElementById('grid');
            gridElement.innerHTML = ''; // Limpiar la cuadr√≠cula
            for (let i = 0; i < gridSize * gridSize; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                gridElement.appendChild(cell);
            }
        }

        // Mostrar las serpientes y la manzana
        function render() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.style.backgroundColor = '#fff';  // Reiniciar el color
                cell.innerHTML = '';  // Limpiar contenido
            });

            // Mostrar la serpiente del jugador
            playerSnake.forEach(segment => {
                const indexCell = segment.y * gridSize + segment.x;
                cells[indexCell].style.backgroundColor = 'green';
            });

            // Mostrar la serpiente de la IA
            aiSnake.forEach(segment => {
                const indexCell = segment.y * gridSize + segment.x;
                cells[indexCell].style.backgroundColor = 'red';
            });

            // Mostrar la manzana
            const appleIndex = apple.y * gridSize + apple.x;
            cells[appleIndex].innerHTML = '<span class="apple">üçé</span>';
        }

        // Mover la serpiente
        function moveSnake(snake, direction) {
            const newHead = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

            // Implementaci√≥n de NoClip: si se sale por un borde, aparece en el borde opuesto
            if (newHead.x < 0) newHead.x = gridSize - 1;
            if (newHead.x >= gridSize) newHead.x = 0;
            if (newHead.y < 0) newHead.y = gridSize - 1;
            if (newHead.y >= gridSize) newHead.y = 0;

            snake.unshift(newHead);

            if (newHead.x === apple.x && newHead.y === apple.y) {
                apple = generateApple();
            } else {
                snake.pop();
            }
        }

        // L√≥gica de la IA para moverse hacia la manzana
        function aiMove() {
            const head = aiSnake[0];
            const dx = apple.x - head.x;
            const dy = apple.y - head.y;

            if (Math.abs(dx) > Math.abs(dy)) {
                aiDirection = dx > 0 ? { x: 1, y: 0 } : { x: -1, y: 0 };
            } else {
                aiDirection = dy > 0 ? { x: 0, y: 1 } : { x: 0, y: -1 };
            }

            moveSnake(aiSnake, aiDirection);
        }

        // Verificar colisiones entre las serpientes, pero sin afectar el juego
        function checkCollision() {
            // Ignorar las colisiones entre las serpientes, ya que se comportan como no-clip
            if (playerSnake.some(segment => aiSnake.some(aiSegment => aiSegment.x === segment.x && aiSegment.y === segment.y))) {
                return;  // Si las serpientes se encuentran, solo continuamos el juego
            }
        }

        // Mover las serpientes
        function move() {
            if (gameOver || !gameStarted || !canMove) return;

            canMove = false;

            moveSnake(playerSnake, playerDirection);
            aiMove();
            checkCollision();

            render();

            setTimeout(() => canMove = true, speed);
            setTimeout(move, speed);
        }

        // Generar una nueva manzana
        function generateApple() {
            let newApple;
            do {
                newApple = { x: Math.floor(Math.random() * gridSize), y: Math.floor(Math.random() * gridSize) };
            } while (playerSnake.some(segment => segment.x === newApple.x && segment.y === newApple.y) || aiSnake.some(segment => segment.x === newApple.x && segment.y === newApple.y));
            return newApple;
        }

        // Cambiar la direcci√≥n del jugador
        function changeDirection(event) {
            if (gameOver) return;

            if (!gameStarted) startGame();

            if (event.key === "ArrowUp" && playerDirection.y === 0) playerDirection = { x: 0, y: -1 };
            else if (event.key === "ArrowDown" && playerDirection.y === 0) playerDirection = { x: 0, y: 1 };
            else if (event.key === "ArrowLeft" && playerDirection.x === 0) playerDirection = { x: -1, y: 0 };
            else if (event.key === "ArrowRight" && playerDirection.x === 0) playerDirection = { x: 1, y: 0 };
        }

        // Iniciar el juego
        function startGame() {
            gameStarted = true;
            document.getElementById('gameStatus').textContent = '¬°Juego en progreso!';
            move();
        }

        // Actualizar la velocidad del juego
        function updateSpeed(event) {
            speed = parseInt(event.target.value);
            document.getElementById('speedValue').textContent = `${speed}ms`;
        }

        // Reiniciar el juego
        function restartGame() {
            playerSnake = [{ x: 14, y: 14 }];
            aiSnake = [{ x: 16, y: 16 }];
            playerDirection = { x: 0, y: -1 };
            aiDirection = { x: 0, y: -1 };
            apple = { x: 12, y: 12 };
            gameOver = false;
            gameStarted = false;
            canMove = true;
            document.getElementById('gameStatus').textContent = '¬°Presiona cualquier tecla para empezar!';
            document.getElementById('restartButton').style.display = 'none';
            render();
        }

        // Crear la cuadr√≠cula y establecer los eventos
        createGrid();
        window.addEventListener('keydown', changeDirection);
        document.getElementById('speedControl').addEventListener('input', updateSpeed);
    </script>
</body>
</html>
